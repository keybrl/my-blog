---
title: U 盘格式化参数到底怎么选
date: 2020-02-08
updated: 2020-02-08
layout: post
categories:
- 无聊的日常
tags:
- 搞机
thumbnail: 
---

U 盘格式化是我们经常要做的事情，起码对于我来说是经常要做的。比如重装系统要做个装机盘，一般被格式化为了 FAT32 ，用完还要格式化回来。比如 U 盘拷过游戏，小文件太多，删除太慢，干脆直接格式化。

格式化也没什么，像 Windows 自带的工具就很方便。但是我一直被一个问题所困扰...

![format-ui](https://oss.keybrl.com/images/how-to-format-a-usb-flash-disk/format-ui.png)

就是这些选项该选什么？ Windows 支持的 3 种文件系统和若干分块大小可以组合出几十种选择，到底有什么不同。他们真的只是“无关紧要”的只需要“选择默认就好”的吗？它们对性能的影响到底有多大呢？

我曾经也试图通过搜索引擎寻找答案，但是他们大多只会告诉你一些大概，比如“分块越大性能越好，只是空间浪费越多”，或者“为了兼容的话可以选 FAT32 ，为了性能的话 exFAT ，不知道怎么选的话就选 NTFS”之类的，但是具体到使用上能有多大的差别却很少被提及。所以今天，我来试图探究一下这个问题。

开始之前我先简单介绍一下这些选项都是什么意思。

## 文件系统

首先，我们可以简单理解为裸盘上存储的是 01 比特，操作系统可以通过驱动程序从中读取和写入比特，但是我们看到的是文件、目录。那么这中间是谁做了这一层抽象呢，就是文件系统。文件系统抽象出了目录、文件等概念，然后提供接口给上层应用操作这些文件和目录。文件系统有很多种，不同的文件系统是有不同的特性的，比如支持的文件名长度、单个文件最大大小、最大目录深度等都会有不同，对不同的文件系统的操作方式也会有不同，所以操作系统一般会在其上再抽象一层（一个抽象文件系统）。然后就成了我们在文件资源管理器看到的，一个个目录和文件。

所以文件系统其实就是一个对文件和目录如何落实到比特的定义，不同的文件系统因为定义不同会有不同的特性和性能表现，同一种文件系统在不同的操作系统中也会因为实现的不同而有不同的性能表现（比如 exFAT 在 Ubuntu 上就体验相对糟糕）。

目前主流的应用于 U 盘的文件系统，在 Windows 平台是 exFAT 、 FAT32 、 NTFS ， MacOS 是 exFAT 、 FAT32 和另外两种 MacOS 自己的日志型文件系统， Linux 的话其实都可以，取决于内核编译时有没有勾选相关模块， Ubuntu 的话默认支持 FAT32 、 NTFS 、 Ext4 ， exFAT 的话需要安装额外的模块才能使用。

这篇文章主要就讨论在 Windows 平台上支持的 exFAT 、 FAT32 和 NTFS 。这三种文件系统在 4 大主流平台的兼容性：

|       | Windows | Linux | MacOS | Android |
| ----- | ------- | ------ | ------ | ------------- |
| FAT32 | 兼容    | 兼容   | 兼容  | 兼容          |
| exFAT | 兼容    | 不太好 | 兼容  | 不太好        |
| NTFS  | 兼容    | 兼容   | 不兼容 | 比 exFAT 略好 |

> “不太好”和“比 exFAT 略好”都是我自己感觉的，不好主要表现传输速度比较低、可靠性比较低、加载和卸载设备时可能需要较长时间之类的现象

这三种文件系统，按照网络上通用的说法，一般是这样的：

1. FAT32 是最古老的，兼容性最好，几乎任何设备、任何平台都兼容，而且性能好。主要缺点是单文件不能超过 4GB （所以为什么手机和有些相机 1080p 60fps 录个半小时就停了）；
2. NTFS 是 Windows 系统盘的文件系统，也是硬盘、 SSD 推荐使用的，没有什么短板，兼容性也还可以（ MacOS 不兼容），但是不适合 U 盘（据说因为反复读写日志？）；
3. exFAT 是微软专门为移动存储设备设计的，性能好，兼容性尚可（ Linux 和部分 Android 手机兼容不太好），也没有什么限制，总之强无敌，推荐 U 盘使用。

但是除了那些显而易见的，比如兼容性、文件大小限制，其它的方面似乎都很难感受到，而且最重要是它们性能差别有多大呢？所以我们后面来探究这个问题。

## 分配单元大小

